<!DOCTYPE html>
<html>
<head>
  <title>YouTube Downloader</title>
  <script>
    async function fetchFormats() {
      const url = document.getElementById('url').value;
      const res = await fetch('/formats', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({url})
      });
      const formats = await res.json();
      const select = document.getElementById('format');
      select.innerHTML = formats.map(f => 
        `<option value="${f.format_id}">${f.format_id} - ${f.resolution} (${f.ext})</option>`
      ).join('');
    }

    async function startDownload() {
      const url = document.getElementById('url').value;
      const format_id = document.getElementById('format').value;
      const res = await fetch('/download', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({url, format_id})
      });
      const data = await res.json();
      const id = data.download_id;
      const status = document.getElementById('status');

      const interval = setInterval(async () => {
        const pRes = await fetch('/progress/' + id);
        const pData = await pRes.json();
        status.innerText = `Progress: ${pData.progress || '0%'} - ${pData.status}`;
        if (pData.status === 'finished') {
          clearInterval(interval);
          const a = document.createElement('a');
          a.href = '/download/' + id;
          a.innerText = 'Download Now';
          a.download = '';
          document.body.appendChild(a);
          a.click();
        }
      }, 1000);
    }
  </script>
</head>
<body>
  <h2>YouTube Downloader</h2>
  <input type="text" id="url" placeholder="Enter YouTube URL" style="width: 60%;">
  <button onclick="fetchFormats()">Get Formats</button><br><br>

  <label>Select Quality:</label>
  <select id="format"></select>
  <button onclick="startDownload()">Download</button>
  <p id="status"></p>
</body>
</html>
